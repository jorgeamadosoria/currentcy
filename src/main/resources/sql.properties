#code,buy,sell,buy,sell,code,limit,code,limit
save.snapshot=INSERT INTO snapshot (code, buy,sell,date) VALUES (?,?,?,now()) ON DUPLICATE KEY UPDATE buy=?,sell=?,prev_buy=(select avg(buy) from (select buy,date(date) as day from samples where code= ? group by date(date) order by date(date) desc limit ?) tbl1),prev_sell=(select avg(sell) from (select sell,date(date) as day from samples where code= ? group by date(date) order by date(date) desc limit ?) tbl1),prev_date=date,date=now()
select.snapshot=select code, buy as buy_value,sell as sell_value,date,buy-prev_buy as buy_diff,sell - prev_sell as sell_diff from snapshot
#code,buy,sell
save.sample=INSERT INTO samples (code, buy,sell,date) VALUES (?,?,?,now())
#code,code,limit,code,limit
latest.samples=select latest.id as id,latest.buy as buyValue,latest.sell as sellValue,? as code,latest.day as date, latest.buy - prev.buy as buyDiff, latest.sell - prev.sell as sellDiff from (select id, buy,sell,day,@rownum_lastest:=@rownum_lastest + 1 as cnt from (select max(id) as id, buy,sell,code,date(date) as day from samples,(SELECT @rownum_lastest := 0) r where code=? group by day order by day asc limit ?) a ) latest join (select id, buy,sell,day,@rownum_prev:=@rownum_prev + 1 as cnt from (select max(id) as id, buy,sell,date(date) as day from samples,(SELECT @rownum_prev := 0) r where code=? group by day order by day asc limit ?) a) prev on latest.cnt = prev.cnt+1
min.trend.value=select least(min(sell),min(buy)) from samples where code= ? limit ?
max.trend.value=select greatest(max(sell),max(buy)) from samples where code= ? limit ?
latest.average=select avg(buy),avg(sell) from (select buy,sell,date(date) as day from samples where code= ? group by date(date) order by date(date) desc limit ?) tbl1
token.email=select token from email where address=?
email.exists=select exists(select email from email where email=?)
token.exists=select exists(select token from email where token=?)
save.email=insert into email (email,token,active) values (?,?,0)
delete.email=delete from email where token=?
activate.email=update email set active=1 where token=?
select.emails=select email from email where token is null limit ? offset ?
